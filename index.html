<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIAF PE | Login Institucional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --pe-blue: #003399; --pe-yellow: #ffcc00; }
        body { 
            background: linear-gradient(135deg, var(--pe-blue) 0%, #001a4d 100%); 
            height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Inter', sans-serif;
            margin: 0;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 40px; border-radius: 30px; width: 90%; max-width: 420px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-top: 8px solid var(--pe-yellow);
        }
        .logo-box { background: var(--pe-blue); padding: 25px; border-radius: 15px; margin-bottom: 25px; }
        .btn-pe { background: var(--pe-blue); border: none; padding: 12px; border-radius: 30px; font-weight: 600; color: white; transition: 0.3s; width: 100%; }
        .btn-pe:hover { background: #002673; transform: scale(1.02); }
        .form-control { border-radius: 30px; padding: 12px 20px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="login-card text-center">
        <div class="logo-box">
            <img src="logo-SEE-branca-1-2_novo.png" alt="Secretaria de Educação PE" class="img-fluid">
        </div>

        <h4 class="fw-bold mb-1">SIAF PE</h4>
        <p class="text-muted small mb-4">Gestão de Frequência Escolar</p>
        
        <div id="login-form">
            <input type="text" id="u" class="form-control mb-3" placeholder="Usuário">
            <input type="password" id="p" class="form-control mb-4" placeholder="Senha">
            <button class="btn btn-pe mb-3" id="btnLogin">ACESSAR PAINEL</button>
            <hr>
            <a href="terminal.html" class="btn btn-outline-primary w-100 rounded-pill fw-bold"><i class="fas fa-camera me-2"></i> IR PARA O TERMINAL</a>
            <a href="#" class="text-muted small mt-3 d-block" onclick="toggleR(true)">Esqueceu a senha?</a>
        </div>
        
        <div id="recover-form" style="display:none">
            <input type="email" id="eR" class="form-control mb-3" placeholder="E-mail cadastrado">
            <button class="btn btn-pe mb-3" id="btnR">RECUPERAR</button>
            <a href="#" class="text-muted small d-block" onclick="toggleR(false)">Voltar</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = { 
            apiKey: "AIzaSyDgR98RtL8sgxVbEV2Swyb2wnHLSPt3cDo", 
            authDomain: "escolapro-15e5e.firebaseapp.com", 
            projectId: "escolapro-15e5e", 
            storageBucket: "escolapro-15e5e.firebasestorage.app", 
            messagingSenderId: "339019791514", 
            appId: "1:339019791514:web:44e0d58b6835f0fe6df323" 
        };
        
        const app = initializeApp(firebaseConfig); 
        const db = getFirestore(app);
        
        window.toggleR = (s) => { 
            document.getElementById('login-form').style.display = s ? 'none' : 'block'; 
            document.getElementById('recover-form').style.display = s ? 'block' : 'none'; 
        };
        
        document.getElementById('btnLogin').onclick = async () => {
            const user = document.getElementById('u').value, pass = document.getElementById('p').value;
            if(user === "Adm master" && pass === "Gabriel@01") { 
                localStorage.setItem('usuarioLogado', JSON.stringify({usuario: "Adm master", permissoes: ["aba-stats", "aba-consultas", "aba-facial", "aba-faltas", "aba-usuarios"]})); 
                window.location.href = 'dashboard.html'; return; 
            }
            const q = query(collection(db, "logins"), where("usuario", "==", user), where("senha", "==", pass));
            const snap = await getDocs(q);
            if(!snap.empty) { 
                snap.forEach(d => { 
                    localStorage.setItem('usuarioLogado', JSON.stringify(d.data())); 
                    window.location.href = 'dashboard.html'; 
                }); 
            } else { alert("Acesso Negado"); }
        };
    </script>
</body>
</html>