<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIAF PE | Acesso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --pe-blue: #003399; --pe-yellow: #ffcc00; }
        body { background: var(--pe-blue); height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .login-card { background: white; padding: 35px; border-radius: 20px; width: 90%; max-width: 400px; border-top: 8px solid var(--pe-yellow); box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
        .btn-pe { background: var(--pe-blue); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: 600; }
        .btn-pe:hover { background: #002673; color: white; }
    </style>
</head>
<body>
    <div class="login-card text-center">
        <i class="fas fa-landmark fa-3x mb-3 text-primary"></i>
        <h4 class="fw-bold mb-0">SIAF PERNAMBUCO</h4>
        <p class="text-muted small mb-4">Sistema de Frequência Escolar</p>

        <div id="login-form">
            <input type="text" id="userInput" class="form-control mb-3" placeholder="Usuário">
            <input type="password" id="passInput" class="form-control mb-3" placeholder="Senha">
            <button class="btn btn-pe mb-3" id="btnLogin">ENTRAR</button>
            <br><a href="#" class="text-decoration-none small" onclick="toggleRecover(true)">Esqueceu a senha?</a>
        </div>

        <div id="recover-form" style="display:none">
            <input type="email" id="emailRecover" class="form-control mb-3" placeholder="E-mail cadastrado">
            <button class="btn btn-pe mb-3" id="btnRecover">RECUPERAR</button>
            <br><a href="#" class="text-decoration-none small" onclick="toggleRecover(false)">Voltar</a>
        </div>
        <div id="msg" class="mt-3 small fw-bold"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDgR98RtL8sgxVbEV2Swyb2wnHLSPt3cDo",
            authDomain: "escolapro-15e5e.firebaseapp.com",
            projectId: "escolapro-15e5e",
            storageBucket: "escolapro-15e5e.firebasestorage.app",
            messagingSenderId: "339019791514",
            appId: "1:339019791514:web:44e0d58b6835f0fe6df323"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.toggleRecover = (show) => {
            document.getElementById('login-form').style.display = show ? 'none' : 'block';
            document.getElementById('recover-form').style.display = show ? 'block' : 'none';
        };

        document.getElementById('btnLogin').onclick = async () => {
            const u = document.getElementById('userInput').value;
            const p = document.getElementById('passInput').value;
            if(u === 'marcio' && p === '1234') {
                localStorage.setItem('usuarioLogado', JSON.stringify({usuario: 'Márcio', permissoes: ['admin']}));
                window.location.href = 'dashboard.html'; return;
            }
            const q = query(collection(db, "logins"), where("usuario", "==", u), where("senha", "==", p));
            const snap = await getDocs(q);
            if(!snap.empty) {
                snap.forEach(d => { localStorage.setItem('usuarioLogado', JSON.stringify(d.data())); window.location.href = 'dashboard.html'; });
            } else { document.getElementById('msg').innerText = "Dados incorretos"; }
        };

        document.getElementById('btnRecover').onclick = async () => {
            const e = document.getElementById('emailRecover').value;
            const q = query(collection(db, "logins"), where("email", "==", e));
            const snap = await getDocs(q);
            if(!snap.empty) { alert("E-mail de recuperação enviado!"); toggleRecover(false); }
            else { alert("E-mail não encontrado!"); }
        };
    </script>
</body>
</html>